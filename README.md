# DevBox - Локальное окружение разработки

DevBox - это минимальный набор инструментов для PHP разработки.

Задумана как легкая альтернатива Devilbox. Позволяет хостить проекты в локальной среде на
разных версиях php.

## Требования

- Podman
- Podman Compose
- Bash (опционально. Требуется для утилит)

Можно запустить и на Docker Compose если поправить docker-compose.yaml

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/dblackCat/devbox.git
```

2. В директории config/* добавьте файлы конфигурации для сервисов.
Примеры есть в .example файлах.

2. Создайте файл `.env` в корневой директории проекта. Пример есть в .env.example.
```bash
# Настройки хостов
HOST_ZONE=dvl.to
DEFAULT_PHP_VERSION=php82

# Настройки MySQL
MYSQL_ROOT_PASSWORD=root

# Маппинг
USER_ID=1000
GROUP_ID=1000
```

3. Добавьте путь до утилит в конец файла ~/.bashrc:
```bash
export PATH="$HOME/Путь до окружения/scripts:$PATH" 
```
Это необходимо, что бы добавить алиасы функций devbox-*
Функции писались специально для экспорта в пространство пользователя.

Сам по себе набор утилит является всего лишь оберткой над podman compose.

Без утилит запускать, останавливать, собирать и заходить в контейнеры нужно через podman:

```bash
sudo podman compose up -d
sudo podman compose down
sudo podman compose build
sudo podman exec -it {container-alias} bash
```

## Доступные утилиты

### Управление окружением

#### Запуск окружения
```bash
devbox-start
```
Запускает все контейнеры в фоновом режиме.

#### Остановка окружения
```bash
devbox-stop
```
Останавливает все контейнеры.

#### Перезапуск окружения
```bash
devbox-restart
```
Перезапускает все контейнеры.

#### Сборка и запуск окружения
```bash
devbox-build
```
Пересобирает и запускает все контейнеры. Используйте если вносите изменения в docker-compose.yaml
Запуск осуществляется не в фоне, что бы видеть весь лог.

### Управление хостами

#### Создание нового хоста
```bash
devbox-host <название_хоста> [--php<версия>]
```
Создает новый хост с указанной версией PHP.
По факту создает директорию и кладет шаблонный конфиг nginx.  Вам нужно добавить в 
/etc/hosts алиас хоста самостоятельно.

Примеры:
```bash
# Создание хоста с PHP 8.2 (по умолчанию)
devbox-host my-project

# Создание хоста с PHP 7.4
devbox-host legacy-project --php74

# Создание хоста с PHP 8.0
devbox-host modern-project --php80
```

### Работа с контейнерами

#### Вход в контейнер
```bash
devbox-container <название_контейнера>
```
Открывает интерактивную сессию в указанном контейнере.
По факту обертка над podman exec.

Все php контейнеры сконфигурированы, добавлены базовые утииты для работы:
1. composer
2. nano
3. mc
4. npm
5. curl
6. bash
7. zip
8. unzip

Добавлены все расширения php, кроме xDebug. 
Его мне завести в этой сборке не удалось.

Примеры:
```bash
# Вход в контейнер PHP 8.2
devbox-container php82

# Вход в контейнер nginx
devbox-container php80

# Вход в контейнер MySQL
devbox-container php74
```

#### Просмотр логов
```bash
devbox-logs <название_контейнера> [--follow]
```
Показывает логи указанного контейнера.

Примеры:
```bash
# Просмотр логов nginx
devbox-logs nginx

# Просмотр логов с автоматическим обновлением
devbox-logs nginx --follow

# Просмотр логов PHP 8.2
devbox-logs php82
```

### Справка
```bash
devbox-help
```
Показывает список всех доступных команд.

## Структура проекта

```
.
├── config/                 # Конфигурационные файлы
│   ├── mysql/             # Конфигурация MySQL
│   ├── nginx/             # Конфигурация Nginx
│   ├── php7.4/            # Конфигурация PHP 7.4
│   ├── php8.0/            # Конфигурация PHP 8.0
│   └── php8.2/            # Конфигурация PHP 8.2
├── hosts/                 # Директория с хостами
│   └── <host-name>/       # Директория хоста
│       ├── htdocs/        # Корневая директория веб-сервера
│       └── nginx.conf     # Конфигурация Nginx для хоста
├── logs/                  # Логи контейнеров
├── data/                  # Данные контейнеров
├── scripts/               # Скрипты управления
│   └── devbox.sh         # Основной скрипт управления
├── docker-compose.yaml    # Конфигурация Docker Compose
└── .env                   # Переменные окружения
```

## Доступные сервисы

- **Nginx**: Веб-сервер (порт 80)
- **PHP 7.4**: PHP-FPM (порт 9074)
- **PHP 8.0**: PHP-FPM (порт 9080)
- **PHP 8.2**: PHP-FPM (порт 9081)
- **MySQL**: База данных (порт 3306)
- **phpMyAdmin**: Управление MySQL (порт 8080)

## Примечания

- Все хосты доступны по домену `*.dvl.to` если не указано другое в .env
- phpMyAdmin доступен по адресу `http://localhost:8080`
- Для входа в phpMyAdmin используйте:
  - Логин: `root`
  - Пароль: значение из `MYSQL_ROOT_PASSWORD` в файле `.env` 
- Окружение может содержать баги. Поэтому все на свой страх и риск.